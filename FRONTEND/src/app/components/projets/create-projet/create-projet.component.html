<!-- projet.component.html -->

<div class=container>
    <div class="progress-tracker">
        <div 
          class="progress-fill" 
          [style.width.%]="(currentStep - 1) / (steps.length - 1) * 100">
        </div>
      
        <div class="step" *ngFor="let step of steps; let i = index">
          <div class="step-circle" 
               [ngClass]="{
                 'completed': currentStep > i + 1,
                 'active': currentStep === i + 1
               }">
            {{ i + 1 }}
          </div>
          <div class="step-label">{{ step }}</div>
        </div>
      </div>
      


  <!-- Formulaire -->
  <form [formGroup]="projetForm" (ngSubmit)="createProjetInfos()" class="form-container" *ngIf='projetFormVisible'>
      <!-- Nom du projet -->
      <div class="form-group">
          <label for="nom"><i class="fas fa-project-diagram"></i> Nom du Projet</label>
          <input
              type="text"
              id="nom"
              class="form-control"
              formControlName="nom"
              placeholder="Entrez le nom du projet"
          />
          <span class="error-message" *ngIf="projetForm.get('nom')?.touched && projetForm.get('nom')?.invalid">
              <span *ngIf="projetForm.get('nom')?.errors?.['required']">Ce champ est requis.</span>
              <span *ngIf="projetForm.get('nom')?.errors?.['maxlength']">Le nom ne peut pas dépasser 255 caractères.</span>
          </span>
      </div>

      <!-- Type du projet -->
      <div class="form-group">
          <label for="typeProjet"><i class="fas fa-list"></i> Type de Projet</label>
          <select id="typeProjet" class="form-control" formControlName="typeProjet">
              <option value="">Sélectionnez le type de projet</option>
              <option value="infrastructure">Infrastructure</option>
              <option value="energie">Énergie</option>
              <option value="sante">Santé</option>
              <option value="education">Éducation</option>
              <option value="transport">Transport</option>
              <option value="autre">Autre</option>
          </select>
          <span class="error-message" *ngIf="projetForm.get('typeProjet')?.touched && projetForm.get('typeProjet')?.invalid">
              <span *ngIf="projetForm.get('typeProjet')?.errors?.['required']">Ce champ est requis.</span>
          </span>
      </div>

      <!-- Budget -->
      <div class="form-group">
          <label for="budget"><i class="fas fa-money-bill-wave"></i> Budget</label>
          <input
              type="number"
              id="budget"
              class="form-control"
              formControlName="budget"
              placeholder="Entrez le budget du projet"
          />
          <span class="error-message" *ngIf="projetForm.get('budget')?.touched && projetForm.get('budget')?.invalid">
              <span *ngIf="projetForm.get('budget')?.errors?.['required']">Ce champ est requis.</span>
              <span *ngIf="projetForm.get('budget')?.errors?.['min']">Le budget doit être supérieur à 0.</span>
          </span>
      </div>

      <!-- Prestataire -->
      <div class="form-group">
          <label for="prestataire"><i class="fas fa-building"></i> Prestataire</label>
          <select id="prestataire" class="form-control" formControlName="prestataire">
            <option value="">Sélectionnez un prestataire</option>
            <option *ngFor="let prestataire of prestataires" [value]="prestataire.id">
              {{ prestataire.nom_entreprise }}--{{ prestataire.secteur_activite}}
            </option>
          </select>
          <span class="error-message" *ngIf="projetForm.get('prestataire')?.touched && projetForm.get('prestataire')?.invalid">
              <span *ngIf="projetForm.get('prestataire')?.errors?.['required']">Ce champ est requis.</span>
          </span>
      </div>

      <!-- Date de début -->
      <div class="form-group">
          <label for="dateDebut"><i class="fas fa-calendar-alt"></i> Date de Début</label>
          <input
              type="date"
              id="dateDebut"
              class="form-control"
              formControlName="dateDebut"
          />
          <span class="error-message" *ngIf="projetForm.get('dateDebut')?.touched && projetForm.get('dateDebut')?.invalid">
              <span *ngIf="projetForm.get('dateDebut')?.errors?.['required']">Ce champ est requis.</span>
          </span>
      </div>

      <!-- Date de fin -->
      <div class="form-group">
          <label for="dateFin"><i class="fas fa-calendar-alt"></i> Date de Fin</label>
          <input
              type="date"
              id="dateFin"
              class="form-control"
              formControlName="dateFin"
          />
      </div>

      <!-- Statut -->
      <div class="form-group">
          <label for="statut"><i class="fas fa-info-circle"></i> Statut</label>
          <select id="statut" class="form-control" formControlName="statut">
              <option value="planifie">Planifié</option>
              <option value="en_cours">En Cours</option>
              <option value="termine">Terminé</option>
          </select>
          <span class="error-message" *ngIf="projetForm.get('statut')?.touched && projetForm.get('statut')?.invalid">
              <span *ngIf="projetForm.get('statut')?.errors?.['required']">Ce champ est requis.</span>
          </span>
      </div>

      <!-- Champ caché pour user -->
      <input type="hidden" formControlName="user" value="1">

      <!-- Bouton Soumettre -->
      <div class="form-group">
          <button
            type="submit" 
           (click)='ngProjetFormDetailsVisible()' 
           classBEGINNING OF RESPONSE="btn btn-primary" 
           [disabled]="projetForm.invalid" 
           *ngIf='projetFormVisibleButton'>
          Ajouter les infos
          </button>
      </div>
  </form>

 

  <form [formGroup]="projetFormDetails" (ngSubmit)="createProjetDetails()" class="form-container" *ngIf='projetFormDetailsVisible'>
   
    <div class="form-group">
        <label for="objectifs"><i class="fas fa-project-diagram"></i> les objectifs</label>
        <input
            type="text"
            id="objectifs"
            class="form-control"
            formControlName="objectifs"
            placeholder="Entrez le nom du projet"
        />
        <span class="error-message" *ngIf="projetFormDetails.get('objectifs')?.touched && projetFormDetails.get('objectifs')?.invalid">
            <span *ngIf="projetFormDetails.get('objectifs')?.errors?.['required']">Ce champ est requis.</span>
            <span *ngIf="projetFormDetails.get('objectifs')?.errors?.['maxlength']">Le nom ne peut pas dépasser 255 caractères.</span>
        </span>
    </div>

        
        <div class="form-group">
          <label for="description"><i class="fas fa-project-diagram"></i> Entrer la description</label>
          <input
              type="text"
              id="description"
              class="form-control"
              formControlName="description"
              placeholder="Entrez le nom du projet"
          />
          <span class="error-message" *ngIf="projetFormDetails.get('description')?.touched && projetFormDetails.get('description')?.invalid">
              <span *ngIf="projetFormDetails.get('description')?.errors?.['required']">Ce champ est requis.</span>
              <span *ngIf="projetFormDetails.get('description')?.errors?.['maxlength']">Le nom ne peut pas dépasser 255 caractères.</span>
          </span>
      </div>
      <div class="form-group">
        <button type="submit" (click)='ngProjetFormLocalisationVisible()' classBEGINNING OF RESPONSE="btn btn-primary" [disabled]="currentStep === steps.length || projetFormDetails.invalid" *ngIf='projetFormDetailsVisibleButton'>Ajouter les details</button>
    </div>
</form>

<form [formGroup]="projetFormLocalisation" (ngSubmit)="createProjetLocalisation()" class="form-container" *ngIf='projetFormLocalisationVisible'>
  <div class="form-group">
    <label for="region"><i class="fas fa-project-diagram"></i> Région</label>
    <input
      type="text"
      id="region"
      class="form-control"
      formControlName="region"
      placeholder="Entrez la région"
    />
    <span class="error-message" *ngIf="projetFormLocalisation.get('region')?.touched && projetFormLocalisation.get('region')?.invalid">
      <span *ngIf="projetFormLocalisation.get('region')?.errors?.['required']">Ce champ est requis.</span>
      <span *ngIf="projetFormLocalisation.get('region')?.errors?.['maxlength']">Le nom ne peut pas dépasser 255 caractères.</span>
    </span>
  </div>

  <!-- Carte interactive -->
  <div class="form-group">
    <label><i class="fas fa-map-marker-alt"></i> Localisation</label>
    <app-map (locationSelected)="onLocationSelected($event)"></app-map>
  </div>

  <!-- Champs pour afficher les coordonnées -->
  <div class="form-group">
    <label for="latitude"><i class="fas fa-map-marker-alt"></i> Latitude</label>
    <input
      type="text"
      id="latitude"
      class="form-control"
      formControlName="latitude"
      placeholder="Latitude"
      readonly
    />
    <span class="error-message" *ngIf="projetFormLocalisation.get('latitude')?.touched && projetFormLocalisation.get('latitude')?.invalid">
      <span *ngIf="projetFormLocalisation.get('latitude')?.errors?.['required']">Ce champ est requis.</span>
      <span *ngIf="projetFormLocalisation.get('latitude')?.errors?.['maxlength']">Le nom ne peut pas dépasser 255 caractères.</span>
    </span>
  </div>

  <div class="form-group">
    <label for="longitude"><i class="fas fa-map-marker-alt"></i> Longitude</label>
    <input
      type="text"
      id="longitude"
      class="form-control"
      formControlName="longitude"
      placeholder="Longitude"
      readonly
    />
    <span class="error-message" *ngIf="projetFormLocalisation.get('longitude')?.touched && projetFormLocalisation.get('longitude')?.invalid">
      <span *ngIf="projetFormLocalisation.get('longitude')?.errors?.['required']">Ce champ est requis.</span>
      <span *ngIf="projetFormLocalisation.get('longitude')?.errors?.['maxlength']">Le nom ne peut pas dépasser 255 caractères.</span>
    </span>
  </div>

  <!-- Bouton pour soumettre -->
  <div class="form-group">
    <button type="submit" (click)='ngProjetFormPartenanireVisible()' classBEGINNING OF RESPONSE="btn btn-primary" [disabled]=" currentStep === steps.length || projetFormLocalisation.invalid" *ngIf='projetFormLocalisationVisibleButton'>Ajouter la localisation</button>
  </div>
</form>

   
<form [formGroup]="projetFormActeurs" (ngSubmit)="createProjetActeurs()" class="form-container" *ngIf='projetFormPartenanireVisible'>

<div class="form-group">
  <label for="partenaire"><i class="fas fa-building"></i> Partenaire</label>
  <select id="partenaire" class="form-control" formControlName="partenaire">
      <option value="">Sélectionnez un prestataire</option>
      <option *ngFor="let partenaire of partenaires" [value]="partenaire.id">
          {{ partenaire.nom }}
      </option>
  </select>

</div>
<div class="form-group">
  <button type="submit" (click)='ngProjetInfosVisible()' class="btn btn-primary" *ngIf='projetFormActeursVisibleButton' [disabled]=" currentStep === steps.length || projetFormActeurs.invalid"  >Ajouter un acteur</button>
</div>
<div class="form-group">
  <button type="submit" (click)='ngProjetSave()' class="btn btn-primary" *ngIf='projetInfosVisibleButton' >Creer le projet</button>
</div>
    </form>
-->
</div>